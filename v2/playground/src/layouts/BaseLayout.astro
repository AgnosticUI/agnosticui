---
import { Moon, Sun } from "lucide-astro";

export interface Props {
  title?: string;
  description?: string;
}

const {
  title = "AgnosticUI v2 - AI-Ready Component Library",
  description = "AI-Ready Component Library - Almost Headless, Framework Agnostic"
} = Astro.props;

// Determine if this is the home page to show illustration
const isHomePage = Astro.url.pathname === '/';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="stylesheet" href="/src/styles/agnostic-shared.css" />
  </head>
  <body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
      <span class="theme-icon">
        <Moon class="moon-icon" size={20} />
        <Sun class="sun-icon" size={20} />
      </span>
    </button>

    <script>
      // Theme Management - Client-side only
      document.addEventListener('DOMContentLoaded', () => {
        console.log('ðŸŸ¢ Theme script executing on client');

        // Update toggle button appearance
        function updateThemeToggle(theme) {
          const moonIcon = document.querySelector(".moon-icon");
          const sunIcon = document.querySelector(".sun-icon");
          if (moonIcon && sunIcon) {
            if (theme === "dark") {
              moonIcon.classList.remove("show");
              sunIcon.classList.add("show");
            } else {
              moonIcon.classList.add("show");
              sunIcon.classList.remove("show");
            }
          }
        }

        // 1. Check localStorage first (highest priority)
        const savedTheme = localStorage.getItem("agnostic-theme");

        // 2. Fall back to system preference
        const systemPrefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;

        // 3. Default to light mode if nothing set
        const initialTheme = savedTheme || (systemPrefersDark ? "dark" : "light");

        // Apply theme immediately
        document.documentElement.setAttribute("data-theme", initialTheme);
        updateThemeToggle(initialTheme);

        // Theme toggle click handler
        document.addEventListener('click', function(e) {
          const themeToggleElement = e.target.closest('#themeToggle');
          if (themeToggleElement) {
            e.preventDefault();
            e.stopPropagation();

            const currentTheme = document.documentElement.getAttribute("data-theme");
            const newTheme = currentTheme === "dark" ? "light" : "dark";

            // Update theme
            document.documentElement.setAttribute("data-theme", newTheme);
            localStorage.setItem("agnostic-theme", newTheme);
            updateThemeToggle(newTheme);
          }
        }, true);

        // Listen for system theme changes
        window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", function(e) {
          if (!localStorage.getItem("agnostic-theme")) {
            const theme = e.matches ? "dark" : "light";
            document.documentElement.setAttribute("data-theme", theme);
            updateThemeToggle(theme);
          }
        });
      });
    </script>

    <main class={`agnostic-container ${isHomePage ? 'home' : ''}`}>
      <div class="nav-header">
        <a class="nav-bar-title" href="/" aria-label="AgnosticUI, back to home">
          AgnosticUI v2
        </a>
      </div>

      <slot />
    </main>
  </body>
</html>