---
import ReactAccordionDemo from "../ReactAccordionDemo.tsx";
import VueAccordionDemo from "../VueAccordionDemo.vue";
import SvelteAccordionDemo from "../SvelteAccordionDemo.svelte";
import { Home, Moon, Sun } from "lucide-astro";
---

<script>
  // Defer loading of non-critical scripts
  import("agnosticui-core");
  import("agnosticui-core/extensions/animated-accordion");
  import("agnosticui-core/experiments/neon-accordion");
  import("agnosticui-core/accordion/styled/MinimalAccordion");
</script>

<style is:global>
  /* Shared styles are loaded in BaseLayout */

  /* Reset default body styles to use our container approach */
  body {
    margin: 0;
    padding: 0;
    background: var(--c-bg-secondary);
  }

  /* Navigation Breadcrumb */
  .nav-breadcrumb {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--c-border);
  }

  .nav-home {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--c-text-light);
    font-size: 0.9rem;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .nav-home:hover {
    color: var(--ag-primary);
  }

  .nav-home svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Basic styling for better visibility */
  h1,
  h2 {
    margin: 1rem 0;
  }

  section {
    margin: 2rem 0;
    padding: 1rem;
    border: 1px solid var(--c-border);
    border-radius: 8px;
    text-align: left;
  }

  /* Ensure all accordion examples are left aligned */
  .accordion-examples {
    text-align: left;
  }

  .accordion-examples * {
    text-align: left;
  }

  ag-accordion-item {
    border: 1px solid var(--c-border);
    margin-bottom: 0.5rem;
    border-radius: 4px;
  }

  ag-accordion-item [slot="header"] {
    padding: 1rem;
    background: var(--c-card-bg);
    font-weight: 600;
    cursor: pointer;
    display: block;
    color: var(--c-text);
  }

  ag-accordion-item [slot="content"] {
    padding: 1rem;
    background: var(--c-card-bg);
  }

  /* Animated Accordion Styling */
  ag-animated-accordion-item {
    border: 1px solid var(--c-border);
    margin-bottom: 0.5rem;
    border-radius: 8px;
    /* Remove overflow: hidden to allow focus rings to be visible */
    transition: box-shadow 0.2s ease;
  }

  ag-animated-accordion-item:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  ag-animated-accordion-item [slot="header"] {
    padding: 1rem;
    background: var(--c-card-bg);
    font-weight: 600;
    cursor: pointer;
    display: block;
    transition: background-color 0.2s ease;
    color: var(--c-text);
  }

  ag-animated-accordion-item [slot="header"]:hover {
    background: var(--c-bg-secondary);
  }

  ag-animated-accordion-item [slot="content"] {
    padding: 1rem;
    background: var(--c-card-bg);
    color: var(--c-text);
  }

  /* Focus styles for accordion buttons - applies to all accordion types */
  ag-accordion-item button:focus-visible,
  ag-animated-accordion-item button:focus-visible,
  minimal-accordion ag-accordion-item button:focus-visible,
  neon-accordion ag-accordion-item button:focus-visible {
    outline: 2px solid var(--ag-focus);
    outline-offset: 2px;
    transition: outline 0.2s ease;
  }

</style>

<!-- Theme Toggle Button -->
<button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
  <span class="theme-icon">
    <Moon class="moon-icon" size={20} />
    <Sun class="sun-icon" size={20} />
  </span>
</button>

<script>
  // Theme Management with localStorage priority system
  (function initTheme() {
    // 1. Check localStorage first (highest priority)
    const savedTheme = localStorage.getItem("agnostic-theme");

    // 2. Fall back to system preference
    const systemPrefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)"
    ).matches;

    // 3. Default to light mode if nothing set
    const initialTheme = savedTheme || (systemPrefersDark ? "dark" : "light");

    // Apply theme
    document.documentElement.setAttribute("data-theme", initialTheme);
    updateThemeToggle(initialTheme);

    // Theme toggle functionality
    const themeToggle = document.getElementById("themeToggle");
    themeToggle?.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";

      // Update DOM
      document.documentElement.setAttribute("data-theme", newTheme);

      // Save to localStorage (user choice takes precedence)
      localStorage.setItem("agnostic-theme", newTheme);

      // Update button
      updateThemeToggle(newTheme);
    });

    // Update toggle button appearance
    function updateThemeToggle(theme: string) {
      const moonIcon = document.querySelector(".moon-icon") as HTMLElement;
      const sunIcon = document.querySelector(".sun-icon") as HTMLElement;
      if (moonIcon && sunIcon) {
        if (theme === "dark") {
          moonIcon.style.display = "none";
          sunIcon.style.display = "block";
        } else {
          moonIcon.style.display = "block";
          sunIcon.style.display = "none";
        }
      }
    }

    // Listen for system theme changes (only if no user preference saved)
    window
      .matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", (e) => {
        if (!localStorage.getItem("agnostic-theme")) {
          const theme = e.matches ? "dark" : "light";
          document.documentElement.setAttribute("data-theme", theme);
          updateThemeToggle(theme);
        }
      });
  })();
</script>

<div class="nav-breadcrumb">
  <a href="/" class="nav-home">
    <Home />
    <span>Back to Components</span>
  </a>
</div>

<h1>Accordion Playground</h1>

<section>
  <h2>Core Web Components Accordion</h2>
  <p>
    This demonstrates the core AgnosticUI accordion functionality with full
    keyboard navigation and accessibility features.
  </p>

  <ag-accordion>
    <ag-accordion-item>
      <span slot="header">Getting Started</span>
      <div slot="content">
        <p>
          This is a web component accordion built with Lit! Click the headers to
          expand/collapse. Use Arrow keys to navigate between items!
        </p>
        <ul>
          <li>Built with modern web standards</li>
          <li>Works in any framework</li>
          <li>Accessible by default</li>
          <li><strong>Arrow key navigation enabled!</strong></li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item open>
      <span slot="header">Features (This one starts open!)</span>
      <div slot="content">
        <p>This accordion has many great features:</p>
        <ul>
          <li>Progressive enhancement</li>
          <li>Keyboard navigation (try Up/Down arrows!)</li>
          <li>ARIA compliance</li>
          <li>Almost headless design</li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item>
      <span slot="header">Customizable</span>
      <div slot="content">
        <p>You can customize the styling however you want!</p>
        <blockquote>
          <p>
            "The styling you see here is just basic CSS. You can make it look
            however you want."
          </p>
        </blockquote>
      </div>
    </ag-accordion-item>
  </ag-accordion>
</section>

<section>
  <h2>React Accordion</h2>
  <p>
    This demonstrates the React wrapper components working seamlessly with the
    underlying web components.
  </p>

  <ReactAccordionDemo client:only="react" />
</section>

<section>
  <h2>Vue Accordion</h2>
  <p>
    This demonstrates the Vue wrapper components working seamlessly with the
    underlying web components.
  </p>

  <VueAccordionDemo client:only="vue" />
</section>

<section>
  <h2>Svelte Accordion</h2>
  <p>
    This demonstrates the Svelte wrapper components working seamlessly with the
    underlying web components using modern Svelte 5 patterns.
  </p>

  <SvelteAccordionDemo client:only="svelte" />
</section>

<section>
  <h2>Pure Lit Event Examples</h2>
  <p style="font-size: 0.875rem; color: var(--c-text-light); margin: 0 0 1rem 0; padding: 0.5rem; background: var(--c-bg-secondary); border-radius: 4px; border: 1px solid var(--c-border);">
    üí° <strong>Console Logging:</strong> Open your browser console (<kbd>F12</kbd> ‚Üí Console tab) to see expand/collapse events from these pure web component examples.
    <a href="javascript:void(0)" onclick="console.log('üéØ TIP: Expand the logged objects to see how we extract event.detail.open, timestamps, and element IDs from the Event argument in addEventListener callbacks!')" style="color: var(--ag-primary); text-decoration: underline;">Click here</a> for event debugging tips!
  </p>

  <ag-accordion id="pure-lit-accordion">
    <ag-accordion-item id="lit-item-1">
      <span slot="header">Pure Lit Section 1</span>
      <div slot="content">
        <p>This section demonstrates pure web component event handling without any framework wrapper.</p>
        <ul>
          <li>Direct addEventListener patterns</li>
          <li>Shadow DOM event bubbling</li>
          <li>Native web component APIs</li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item id="lit-item-2">
      <span slot="header">Pure Lit Section 2</span>
      <div slot="content">
        <p>Watch the console to see how native events are captured and processed.</p>
        <div>
          <h4>Event Details</h4>
          <p>The <code>toggle</code> event provides an <code>open</code> boolean in the detail property.</p>
        </div>
      </div>
    </ag-accordion-item>

    <ag-accordion-item id="lit-item-3">
      <span slot="header">Pure Lit Section 3</span>
      <div slot="content">
        <p>Perfect for vanilla JavaScript applications or custom integrations.</p>
        <blockquote>
          "Use these patterns in any JavaScript environment - no framework required!"
        </blockquote>
      </div>
    </ag-accordion-item>
  </ag-accordion>
</section>

<section>
  <h2>Minimal Chevron Accordion</h2>
  <p>
    Ultra-clean accordion with chevron-only headers and smooth rotation
    animations. Features bare-minimum styling for maximum content focus.
  </p>
  <minimal-accordion>
    <ag-accordion-item>
      <span slot="header">
        Clean Design Philosophy
        <svg class="chevron-icon" viewBox="0 0 20 20" fill="currentColor">
          <path
            fill-rule="evenodd"
            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </span>
      <div slot="content">
        <p>
          This minimal accordion embraces the "less is more" philosophy. With
          system fonts, subtle borders, and a single chevron icon, it puts
          content first while maintaining excellent usability. <strong
            >Try arrow key navigation!</strong
          >
        </p>
        <ul>
          <li>System font integration</li>
          <li>Chevron rotation animation</li>
          <li>Clean border styling</li>
          <li>Minimal visual noise</li>
          <li>Focus on content hierarchy</li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item>
      <span slot="header">
        Accessibility Features
        <svg class="chevron-icon" viewBox="0 0 20 20" fill="currentColor">
          <path
            fill-rule="evenodd"
            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </span>
      <div slot="content">
        <p>
          Built with accessibility as a core principle, featuring excellent
          color contrast, keyboard navigation, and motion preferences support.
        </p>
        <ul>
          <li>WCAG AA color contrast</li>
          <li>Keyboard navigation support (Up/Down arrows, Home/End)</li>
          <li>Focus ring indicators</li>
          <li>Reduced motion respect</li>
          <li>Screen reader friendly</li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item>
      <span slot="header">
        Performance Optimized
        <svg class="chevron-icon" viewBox="0 0 20 20" fill="currentColor">
          <path
            fill-rule="evenodd"
            d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
            clip-rule="evenodd"></path>
        </svg>
      </span>
      <div slot="content">
        <p>
          Lightweight CSS with hardware-accelerated animations and system font
          usage ensures fast loading and smooth interactions across all devices.
        </p>
        <ul>
          <li>Minimal CSS footprint</li>
          <li>Hardware-accelerated transforms</li>
          <li>No web font dependencies</li>
          <li>Optimized selector performance</li>
          <li>Efficient reflow patterns</li>
        </ul>
      </div>
    </ag-accordion-item>
  </minimal-accordion>
</section>

<section>
  <h2>Animated Extension Accordion</h2>
  <p>
    This demonstrates the AnimatedAccordionItem extension with custom animation
    events and duration.
  </p>

  <!-- Need ag-accordion wrapper for keyboard navigation -->
  <ag-accordion>
    <ag-accordion-item>
      <span slot="header">Regular Accordion Test (should work)</span>
      <div slot="content">
        <p>
          This is a regular accordion item to verify basic functionality works
          in this section. <strong>Try arrow key navigation!</strong>
        </p>
      </div>
    </ag-accordion-item>

    <ag-animated-accordion-item animation-duration="500" animation-type="slide">
      <span slot="header">Slow Animation (500ms)</span>
      <div slot="content">
        <p>
          This accordion item uses the AnimatedAccordion extension with a 500ms
          animation duration. <strong>Arrow keys should work here too!</strong>
        </p>
        <ul>
          <li>Custom animation events are dispatched</li>
          <li>Respects prefers-reduced-motion</li>
          <li>Configurable animation types</li>
          <li>Full keyboard navigation support</li>
        </ul>
      </div>
    </ag-animated-accordion-item>

    <ag-animated-accordion-item animation-duration="200" animation-type="fade">
      <span slot="header">Fast Animation (200ms)</span>
      <div slot="content">
        <p>
          This one animates quickly and demonstrates how extensions preserve all
          original functionality while adding new features.
        </p>
        <blockquote>"Extensions should enhance, not replace!"</blockquote>
      </div>
    </ag-animated-accordion-item>

    <ag-animated-accordion-item animation-duration="800">
      <span slot="header">Extra Slow for Demo</span>
      <div slot="content">
        <p>
          This accordion has an 800ms animation to clearly show the smooth
          transitions. <strong>Use Up/Down arrow keys to navigate!</strong>
        </p>
      </div>
    </ag-animated-accordion-item>
  </ag-accordion>
</section>

<section>
  <h2>Retro Neon-Inspired Accordion</h2>
  <p>
    This demonstrates dramatic visual contrast with 80s retro neon aesthetics -
    synthwave colors, glowing effects, and bold typography for maximum "wow
    factor".
  </p>

  <neon-accordion>
    <ag-accordion-item>
      <span slot="header">Cyberpunk Aesthetics</span>
      <div slot="content">
        <p>
          Enter the neon-soaked world of synthwave design! This accordion
          features electric blue gradients, dramatic shadows, and glowing text
          effects that transport you to a retro-futuristic landscape. <strong
            >Navigate with style using arrow keys!</strong
          >
        </p>
        <ul>
          <li>Electric color gradients</li>
          <li>Dramatic glow effects</li>
          <li>Bold uppercase typography</li>
          <li>Theatrical animations</li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item open>
      <span slot="header">Maximum Visual Impact</span>
      <div slot="content">
        <p>
          This experiment pushes the boundaries of what's possible with CSS
          custom properties - demonstrating how the same AgnosticUI component
          can be transformed into something completely different.
        </p>
        <ul>
          <li>Multi-layer box shadows</li>
          <li>Text glow effects</li>
          <li>Hover transformations</li>
          <li>Responsive glow animations</li>
        </ul>
      </div>
    </ag-accordion-item>

    <ag-accordion-item>
      <span slot="header">Accessibility Conscious</span>
      <div slot="content">
        <p>
          Even with all the visual drama, accessibility remains a priority with
          reduced motion support, high contrast adaptations, and proper focus
          indicators.
        </p>
        <ul>
          <li>Reduced motion support</li>
          <li>High contrast modes</li>
          <li>Transparency preferences</li>
          <li>Full keyboard navigation (Up/Down arrows, Home/End)</li>
        </ul>
      </div>
    </ag-accordion-item>
  </neon-accordion>
</section>

<script>
  // Pure Lit Event Examples - DOM-ready setup
  document.addEventListener('DOMContentLoaded', () => {
    // Get all accordion items in the pure lit example
    const pureLitAccordion = document.getElementById('pure-lit-accordion');
    const pureLitItems = pureLitAccordion?.querySelectorAll('ag-accordion-item');

    if (pureLitItems) {
      pureLitItems.forEach((item, index) => {
        // Listen for the toggle event on each accordion item
        item.addEventListener('toggle', (event) => {
          const isOpen = (event as any).detail.open;
          const itemNumber = index + 1;
          console.log(`üéõÔ∏è Pure Lit Accordion Item ${itemNumber}: ${isOpen ? 'EXPANDED' : 'COLLAPSED'}`, {
            expanded: isOpen,
            itemId: item.id,
            timestamp: new Date().toLocaleTimeString(),
            eventType: 'pure-lit-toggle'
          });
        });

        console.log(`‚úÖ Pure Lit event listener attached to accordion item ${index + 1}`);
      });
    }
  });
</script>