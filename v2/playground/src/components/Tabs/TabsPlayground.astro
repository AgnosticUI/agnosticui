---
import { Home } from "lucide-astro";
---

<style is:global>
  .nav-breadcrumb {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--c-border);
  }

  .nav-home {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--c-text-light);
    font-size: 0.9rem;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .nav-home:hover {
    color: var(--ag-primary);
  }

  .nav-home svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Basic tab styling for visibility and functionality */
  ag-tabs {
    display: block;
    margin: 1rem 0;
  }

  ag-tab {
    --ag-tabs-bg: var(--c-card-bg);
    --ag-tabs-text: var(--c-text);
    --ag-tabs-bg-hover: var(--c-bg-secondary);
    --ag-tabs-text-hover: var(--c-text);
    --ag-tabs-text-active: var(--ag-primary);
    --ag-tabs-border-active: var(--ag-primary);

    border: 1px solid var(--c-border);
    margin-right: -1px; /* Overlap borders */
  }

  ag-tab:first-of-type {
    border-radius: 0.375rem 0 0 0.375rem;
  }

  ag-tab:last-of-type {
    border-radius: 0 0.375rem 0.375rem 0;
    margin-right: 0;
  }

  ag-tab-panel {
    --ag-tabs-panel-padding: 1rem;

    border: 1px solid var(--c-border);
    border-radius: 0.375rem;
    background: var(--c-card-bg);
    margin-top: 0.5rem;
  }

  /* Demo tabs specific styling */
  #demo-tabs ag-tab {
    border-radius: 0.25rem 0.25rem 0 0;
    margin-right: 0.25rem;
    border-bottom: none;
  }

  #demo-tabs ag-tab-panel {
    border-radius: 0 0.25rem 0.25rem 0.25rem;
    margin-top: 0;
  }

  /* Demo tabs custom styling (plain HTML buttons, not web components) */
  .demo-tabs-container {
    margin: 1rem 0;
  }

  .demo-tab-list {
    display: flex;
    margin: 0;
    padding: 0;
    border-bottom: 1px solid var(--c-border);
  }

  .demo-tab {
    background: var(--c-card-bg);
    border: 1px solid var(--c-border);
    border-bottom: none;
    color: var(--c-text);
    cursor: pointer;
    font: inherit;
    padding: 0.5rem 1rem;
    margin-right: -1px;
    position: relative;
    border-radius: 0.25rem 0.25rem 0 0;
  }

  .demo-tab:first-child {
    border-radius: 0.25rem 0 0 0;
  }

  .demo-tab:last-child {
    border-radius: 0 0.25rem 0 0;
    margin-right: 0;
  }

  .demo-tab:hover:not([aria-selected="true"]) {
    background: var(--c-bg-secondary);
  }

  .demo-tab[aria-selected="true"] {
    background: var(--c-card-bg);
    color: var(--ag-primary);
    border-bottom-color: var(--c-card-bg);
    z-index: 1;
  }

  .demo-tab:focus-visible {
    outline: var(--ag-focus-width, 2px) solid var(--ag-focus, #2563eb);
    outline-offset: var(--ag-focus-offset, 2px);
  }

  .demo-tab-panel {
    background: var(--c-card-bg);
    border: 1px solid var(--c-border);
    border-radius: 0 0.25rem 0.25rem 0.25rem;
    padding: 1rem;
    margin-top: -1px;
  }

  .demo-tab-panel[hidden] {
    display: none;
  }
</style>

<div>
  <nav class="nav-breadcrumb">
    <a href="/" class="nav-home">
      <Home />
      <span>Home</span>
    </a>
    / Tabs
  </nav>

  <h1>Tabs Component</h1>
  <p>Tabbed interface component with keyboard navigation and accessibility features.</p>

  <section>
    <h2>Basic Tabs</h2>
    <p>
      Basic tabs implementation with manual activation mode. Use Tab key to focus, arrow keys to navigate, and Enter/Space to activate.
    </p>

    <div class="component-showcase">
      <ag-tabs
        activation="manual"
        active-tab="0"
        aria-label="Basic tabs showcase"
        id="main-tabs"
      >
        <ag-tab slot="tab" panel="preview-panel">Preview</ag-tab>
        <ag-tab slot="tab" panel="code-panel">Code</ag-tab>

        <ag-tab-panel slot="panel" id="preview-panel">
          <div class="preview-container">
            <p><strong>Demo:</strong> Interactive tabs with keyboard navigation</p>

            <!-- Use a different element structure to avoid nesting ag-tabs -->
            <div class="demo-tabs-container" id="demo-container">
              <div class="demo-tab-list" role="tablist" aria-label="Demo tabs">
                <button class="demo-tab" role="tab" aria-selected="true" aria-controls="demo-content-1" id="demo-tab-1" data-panel="demo-content-1">
                  Tab 1
                </button>
                <button class="demo-tab" role="tab" aria-selected="false" aria-controls="demo-content-2" id="demo-tab-2" data-panel="demo-content-2" tabindex="-1">
                  Tab 2
                </button>
                <button class="demo-tab" role="tab" aria-selected="false" aria-controls="demo-content-3" id="demo-tab-3" data-panel="demo-content-3" tabindex="-1">
                  Tab 3
                </button>
              </div>

              <div class="demo-tab-panel" role="tabpanel" id="demo-content-1" aria-labelledby="demo-tab-1" tabindex="0">
                <p>This is the content for Tab 1.</p>
                <ul>
                  <li>Built with web components</li>
                  <li>Keyboard navigation with arrow keys</li>
                  <li>Manual activation mode (focus ‚â† selection)</li>
                  <li>Tab to focus, arrows to navigate, Enter/Space to activate</li>
                </ul>
              </div>

              <div class="demo-tab-panel" role="tabpanel" id="demo-content-2" aria-labelledby="demo-tab-2" tabindex="0" hidden>
                <p>This is the content for Tab 2.</p>
                <p>Try using the arrow keys to navigate between tabs, then press Enter or Space to activate them.</p>
                <p>Manual activation mode means you can focus tabs without changing the content until you press Enter/Space.</p>
              </div>

              <div class="demo-tab-panel" role="tabpanel" id="demo-content-3" aria-labelledby="demo-tab-3" tabindex="0" hidden>
                <p>This is the content for Tab 3.</p>
                <p>This demonstrates the manual activation mode where focus and activation are separate actions, which is the recommended approach by WAI-ARIA APG.</p>
              </div>
            </div>
          </div>
        </ag-tab-panel>

        <ag-tab-panel slot="panel" id="code-panel">
          <div class="code-container">
            <pre><code class="language-html">&lt;ag-tabs
  activation="manual"
  active-tab="0"
  aria-label="Sample tabs demo"
&gt;
  &lt;ag-tab slot="tab" panel="demo-panel-1"&gt;Tab 1&lt;/ag-tab&gt;
  &lt;ag-tab slot="tab" panel="demo-panel-2"&gt;Tab 2&lt;/ag-tab&gt;
  &lt;ag-tab slot="tab" panel="demo-panel-3"&gt;Tab 3&lt;/ag-tab&gt;

  &lt;ag-tab-panel slot="panel" id="demo-panel-1"&gt;
    &lt;p&gt;This is the content for Tab 1.&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Built with web components&lt;/li&gt;
      &lt;li&gt;Keyboard navigation with arrow keys&lt;/li&gt;
      &lt;li&gt;Manual activation mode&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/ag-tab-panel&gt;

  &lt;ag-tab-panel slot="panel" id="demo-panel-2"&gt;
    &lt;p&gt;This is the content for Tab 2.&lt;/p&gt;
    &lt;p&gt;Try using the arrow keys to navigate between tabs,
       then press Enter or Space to activate them.&lt;/p&gt;
  &lt;/ag-tab-panel&gt;

  &lt;ag-tab-panel slot="panel" id="demo-panel-3"&gt;
    &lt;p&gt;This is the content for Tab 3.&lt;/p&gt;
    &lt;p&gt;This demonstrates the manual activation mode where
       focus and activation are separate actions.&lt;/p&gt;
  &lt;/ag-tab-panel&gt;
&lt;/ag-tabs&gt;</code></pre>
          </div>
        </ag-tab-panel>
      </ag-tabs>
    </div>
  </section>
</div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // Import the Tabs components
      await import("agnosticui-core");
      await customElements.whenDefined("ag-tabs");
      await customElements.whenDefined("ag-tab");
      await customElements.whenDefined("ag-tab-panel");

      console.log("‚úÖ Tabs components loaded");

      // Initialize syntax highlighting for tab content
      if (typeof window.initSyntaxHighlighting === "function") {
        setTimeout(() => {
          window.initSyntaxHighlighting();
          console.log("‚úÖ Initial syntax highlighting completed");
        }, 300);

        // Setup tab change listener for main tabs
        setTimeout(() => {
          const mainTabs = document.getElementById("main-tabs");
          if (mainTabs) {
            mainTabs.addEventListener("tab-change", () => {
              console.log("üîÑ Main tab changed, re-highlighting code...");
              setTimeout(() => {
                if (typeof window.initSyntaxHighlighting === "function") {
                  window.initSyntaxHighlighting();
                  console.log("‚úÖ Re-highlighting completed");
                }
              }, 100);
            });
          }
        }, 200);
      }

      // Setup demo tabs functionality (custom implementation)
      setTimeout(() => {
        setupDemoTabs();
      }, 400);

    } catch (error) {
      console.error("‚ùå Error loading tabs components:", error);
    }
  });

  // Custom demo tabs implementation (avoiding nested ag-tabs)
  function setupDemoTabs() {
    const demoContainer = document.getElementById("demo-container");
    if (!demoContainer) return;

    const tabs = demoContainer.querySelectorAll('.demo-tab');
    const panels = demoContainer.querySelectorAll('.demo-tab-panel');
    let focusedTabIndex = 0;

    console.log(`üîß Setting up ${tabs.length} demo tabs`);

    function activateTab(index) {
      // Update tabs
      tabs.forEach((tab, i) => {
        if (i === index) {
          tab.setAttribute('aria-selected', 'true');
          tab.setAttribute('tabindex', '0');
        } else {
          tab.setAttribute('aria-selected', 'false');
          tab.setAttribute('tabindex', '-1');
        }
      });

      // Update panels
      panels.forEach((panel, i) => {
        if (i === index) {
          panel.removeAttribute('hidden');
        } else {
          panel.setAttribute('hidden', '');
        }
      });

      focusedTabIndex = index;
      console.log(`üéØ Demo tab ${index + 1} activated`);
    }

    function focusTab(index) {
      if (tabs[index]) {
        tabs[index].focus();
        focusedTabIndex = index;
        console.log(`üéØ Demo tab ${index + 1} focused`);
      }
    }

    // Click handlers
    tabs.forEach((tab, index) => {
      tab.addEventListener('click', () => {
        activateTab(index);
        focusTab(index);
        console.log(`üñ±Ô∏è Demo tab ${index + 1} clicked`);
      });

      // Keyboard navigation
      tab.addEventListener('keydown', (e) => {
        let newIndex = focusedTabIndex;
        let shouldActivate = false;

        switch (e.key) {
          case 'ArrowRight':
            newIndex = (focusedTabIndex + 1) % tabs.length;
            e.preventDefault();
            break;
          case 'ArrowLeft':
            newIndex = focusedTabIndex === 0 ? tabs.length - 1 : focusedTabIndex - 1;
            e.preventDefault();
            break;
          case 'Home':
            newIndex = 0;
            e.preventDefault();
            break;
          case 'End':
            newIndex = tabs.length - 1;
            e.preventDefault();
            break;
          case ' ':
          case 'Enter':
            shouldActivate = true;
            e.preventDefault();
            break;
        }

        if (newIndex !== focusedTabIndex) {
          focusTab(newIndex);
        }

        if (shouldActivate) {
          activateTab(focusedTabIndex);
        }

        console.log(`‚å®Ô∏è Demo tab key: ${e.key}`);
      });
    });

    console.log("‚úÖ Demo tabs setup completed");
  }
</script>